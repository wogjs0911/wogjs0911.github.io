---
key: /2023/03/20/Week17-Day.html
title: TIL - 17주차 코드
tags: springboot thymeleaf transaction
---

# 1. 타임리프 사용법 : 230320

<br>
### 1) 타임리프에서 link 태그를 사용해서 url 생성

- `th:href`는 `@{url 경로}`로 설정하여 이용하는데 "이동 경로"를 의미한다.
- th:href="@{detail(id=${menu.id})}"
- "소괄호"가 쿼리스트링인 "?"를 의미한다.

<br>
- 추가 내용 :
	- `th:text`는 문자열 생성  
	- `th:each`는 반복문
	- `th:if`는 if 조건문

<br>
- 실습 코드 :
	- MenuController.java

```java
	// @RequestMapping에서 detail을 "/detail" 이나 "detail"를 사용하면 된다! 상관없더라
	@RequestMapping("detail")
	public String detail(long id, Model model) {
		// @requestParam은 인자의 변수명이 달라지면 사용하고 이름이 같다면, int로 인자를 바로 받는다. 
		
		
		// 집계가 필요하면, MenuView가 필요하다. 하지만, entity를 따로 만들 수도 있다.
		Menu menu = service.getById(id);
		
		// service 계층에서 받아와서 view 단으로 던져줘서 view 단에서 출력 한다.
		model.addAttribute("menu", menu);
		
		return "menu/detail";
	}
```

- MenuService.java

```java
package kr.co.rland.web.service;

import java.util.List;

import kr.co.rland.web.entity.Menu;
import kr.co.rland.web.entity.MenuView;

public interface MenuService {
	
	// 서비스 계층에서는 사용자 요청을 이름 그대로 그대로 만들어라!!
	void pointUp();
	
	List<Menu> getList();	
	List<Menu> getList(int page);
	List<Menu> getList(int page, String query);
	List<Menu> getList(int page, int categoryId);
	List<Menu> getList(int page, int categoryId, String query);
	
	List<MenuView> getViewList();
	List<MenuView> getViewList(int page);
	List<MenuView> getViewList(int page, String query);
	List<MenuView> getViewList(int page, int categoryId);
	List<MenuView> getViewList(int page, int categoryId, String query);

	Menu getById(long id);
	
}

```

- DefaultMenuService.java


```java

@Override
public Menu getById(long id) {
	Menu menu = repository.findById(id);
	
	return menu;
}
	
```

- test 코드 : 

```java
package kr.co.rland.web.service;

import java.util.List;

import org.junit.jupiter.api.Test;
import org.mybatis.spring.boot.test.autoconfigure.AutoConfigureMybatis;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import kr.co.rland.web.entity.Menu;
import kr.co.rland.web.entity.MenuView;

@SpringBootTest
@AutoConfigureMybatis
class DefaultMenuServiceTest {

	@Autowired
	private MenuService service;
	
	// @Test
	void test() {
		service.pointUp();
		List<MenuView> list = service.getViewList(1, 1);
		System.out.println(list);
		
		
		System.out.println("작업 완료");
	}
	
	
	@Test
	void testgetbyId() {
		Menu menu = service.getById(737L);
		System.out.println(menu);
		
	}
	

}

```

---

<br>
### 2) 타임리프에 문자열 템플릿 적용 

<br>
- 실습코드 :
	- datail.html

```html
<article>
	<header>
		<h1 class="text-title2" th:text="${menu.name}">딸기청</h1>
		<span class="text-normal" th:text="${menu.price}">4,500원</span>
	</header>
	<p class="text-normal" th:text="${menu.description} + ' 원'">신선한 과일로 만들고 알랜드만의 비법으로 직접 만들어서
		다른 곳에서는 느낄 수 없는 상큼함과 새콤함을 자랑합니다.
	</p>
</article>
```

<br>
- Menu.java
	- description 변수 추가 

```java
package kr.co.rland.web.entity;

import java.util.Date;

public class Menu {
	private Long id;
	private String name;
	private Integer price;
	private String img;
	private Date regDate;
	private Integer categoryId;
	private Long regMemberId;
	private String description;

	public Menu() {
		// TODO Auto-generated constructor stub
	}

	public Menu(Long id, String name, Integer price, String img, Date regDate, Integer categoryId, Long regMemberId) {
		super();
		this.id = id;
		this.name = name;
		this.price = price;
		this.img = img;
		this.regDate = regDate;
		this.categoryId = categoryId;
		this.regMemberId = regMemberId;
	}

	public Menu(String name, Integer price, String img, Integer categoryId, Long regMemberId) {
		super();
		this.name = name;
		this.price = price;
		this.img = img;
		this.categoryId = categoryId;
		this.regMemberId = regMemberId;
	}

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public Integer getPrice() {
		return price;
	}

	public void setPrice(Integer price) {
		this.price = price;
	}

	public String getImg() {
		return img;
	}

	public void setImg(String img) {
		this.img = img;
	}

	public Date getRegDate() {
		return regDate;
	}

	public void setRegDate(Date regDate) {
		this.regDate = regDate;
	}

	public Integer getCategoryId() {
		return categoryId;
	}

	public void setCategoryId(Integer categoryId) {
		this.categoryId = categoryId;
	}

	public Long getRegMemberId() {
		return regMemberId;
	}

	public void setRegMemberId(Long regMemberId) {
		this.regMemberId = regMemberId;
	}

	
	public String getDescription() {
		return description;
	}

	public void setDescription(String description) {
		this.description = description;
	}

	@Override
	public String toString() {
		return "Menu [id=" + id + ", name=" + name + ", price=" + price + ", img=" + img + ", regDate=" + regDate
				+ ", categoryId=" + categoryId + ", regMemberId=" + regMemberId + "]";
	}

}

```

<br>
- 문제점 1 : 
	- 위의 실습 코드를 이용하면, style 태그가 적용되지 않고 태그가 그대로 노출된다.
	- 그 이유는 "html 이스케이프"로 인코딩되었기 때문에 이를 인코딩 되지 않고 나오게 해야한다.(`<`가 `&lt`로 인코딩)

<br>
- 해결 방법 1 :
	- 태그의 속성에 `th:utext`만 써주면 된다!(utext의 u는 unencoding의 의미를 가지고 있다.)

```html

<p class="text-normal" th:utext="${menu.description} + ' 원'">
	신선한 과일로 만들고 알랜드만의 비법으로 직접 만들어서 다른 곳에서는 느낄 수 없는 상큼함과 새콤함을 자랑합니다.
</p>

```

---


<br><br>
### 3) 타임리프로 이미지 추가하기

<br>
- th:src 속성 이용

<br>
- 실습 코드 1

```html
<header>
	<h1 class="d-none">수제청</h1>
	<div class="img-div">
		<img alt="" th:src="'/image/menu/' + ${menu.img}" src="https://images.unsplash.com/photo-1515442261605-65987783cb6a?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80">
	</div>
</header>
```

<br>
- 실습 코드 2
	- url에 맞게 데이터 바꿔주기
	
```html
<header>
	<h1 class="d-none">수제청</h1>
	<div class="img-div">
		<!-- <img alt="" th:src="'/image/menu/' + ${menu.img}" src="https://images.unsplash.com/photo-1515442261605-65987783cb6a?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80"> -->
		<img alt="" th:src="@{/image/menu/{img}(img=${menu.img})}" src="https://images.unsplash.com/photo-1515442261605-65987783cb6a?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80">
	
	</div>
</header>
```

```html
<div class="menu-img-box">
    <a href="detail" th:href="@{detail(id=${menu.id})}"><img class="menu-img" th:src="@{/image/menu/{img}(img=${menu.img})}" src="/image/menu/12.png"></a>
</div>    
```

---

<br><br>
### 4) url의 중간에 id를 넣는 방법

- `<a th:href="@{/menus/{id}/edit(id=${menu.id})}">test</a>` 이용!!

```html
<header>
	<h1 class="d-none">수제청</h1>
	<div class="img-div">
		<!-- <img alt="" th:src="'/image/menu/' + ${menu.img}" src="https://images.unsplash.com/photo-1515442261605-65987783cb6a?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80"> -->
		<img alt="" th:src="@{/image/menu/{img}(img=${menu.img})}" src="https://images.unsplash.com/photo-1515442261605-65987783cb6a?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80">
	
		<!-- url의 중간에 id를 넣는 방법  -->
		<a th:href="@{/menus/{id}/edit(id=${menu.id})}">test</a>
	</div>
</header>
```

---

<br><br>
### 5) lombok(롬북) 

- `@Data`는 여러가지를 포함하는 어노테이션이다.(@Getter, @Setter, @NoArgsConstructor, @AllArgsConsructor, @ToString를 포함한다.)
- `@Builder`는 중요하다.


```java
package kr.co.rland.web.entity;

import lombok.Builder;
import lombok.Data;

@Data
@Builder
public class Category {
	private int id;
	private String name;
	
	
}

```

---

<br><br>
### 6) Category 테이블 추가 

- lombok 이용!

<br>
- 에러 주의!! : 
	- mybatis 사용시, 속성에서 namespace, resultType, parameterType 주의!!
	- namespace를 제대로 설정 안 하면, sqlSession에 빈이 없다고 에러가 발생한다!!

<br>
- Category.java

```java
package kr.co.rland.web.entity;

import lombok.Builder;
import lombok.Data;

@Data
@Builder
public class Category {
	private int id;
	private String name;
}

```

<br>
- CategoryRepository.java

```java
package kr.co.rland.web.repository;

import java.util.List;

import org.apache.ibatis.annotations.Mapper;

import kr.co.rland.web.entity.Category;
import kr.co.rland.web.entity.Menu;
import kr.co.rland.web.entity.MenuView;


@Mapper
public interface CategoryRepository {
	

	List<Category> findAll();
	
	Category findById(int id);
	
	// 몇 개 업데이트 되었는지 확인을 위해
	// int형으로 반환한다.
	int insert(Category category);
	
	int update(Category category);
	
	int delete(int id);
	
}

```


<br>
- CategoryRepositoryMapper.java

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.rland.web.repository.CategoryRepository">
	
	<!-- mybatis 사용시, namespace, resultType, parameterType 주의  -->
	<!-- namespace를 제대로 설정안하면, sqlSession에 빈이 없다고 에러가 발생한다. -->
	<select id="findAll" resultType="Category">
		select * 
		from category
	</select>
	
	<insert id="insert" parameterType="Category">
		insert into category(name)
		values(${name})
	</insert>
	
	<update id="update" parameterType="Category">
		update category
		<trim prefix="SET" suffixOverrides=",">
			<if test="name != null">name=#{name}</if>
		</trim>
		where id=#{id}
	</update>
	 
 	<delete id="delete" parameterType="Category">
 		delete from category where id=${id}
	</delete> 
</mapper>
```

<br>
- 테이블을 하나 추가해서 test 코드 : 

```java
package kr.co.rland.web.repository;

import static org.junit.jupiter.api.Assertions.fail;

import java.util.ArrayList;
import java.util.List;

import org.junit.jupiter.api.Test;
import org.mybatis.spring.boot.test.autoconfigure.MybatisTest;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;
import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase.Replace;

import kr.co.rland.web.entity.Category;
import kr.co.rland.web.entity.Menu;

//@AutoConfigureMybatis
//@SpringBootTest
@AutoConfigureTestDatabase(replace=Replace.NONE)
@MybatisTest
class CategoryRepositoryTest {
	
	// @Autowired만 쓰면 안 된다. IOC에 담아줘야 테스트가 돌아간다.. 그래서 @MybatisTest 이용
	@Autowired
	private CategoryRepository repository;
	
	
	// Entity에 ToString가 없으면 list를 주소값으로 반환한다.
	// 우리는 DB의 데이터값이 필요하다.
	@Test
	void testFindAll() {
		List<Category> list = repository.findAll();
		
		System.out.println(list);
	}


}

```


<br>
- 정리 : 
	- Entity에 ToString가 없으면 list를 주소값으로 반환한다.
	- 우리는 DB의 데이터값이 필요하다. 그래서 Entity에 생성자와 toString 만들어 줄 것 


---

<br><br>
# 1. lombok : 230321











