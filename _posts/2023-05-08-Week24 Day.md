---
key: /2023/05/08/Week24-Day.html
title: TIL - 24주차 코드
tags: Vue.js Authentication Authorization Pinia
---

# 1. Vue.js 인증과 권한 : 230508

### 1) Pinia 사용 방법 

- pinia 설치 방법** : `npm install pinia` 

#### a. Pinia 기본 설정 

- main.js

```javascript
import { createApp } from 'vue'
import { createRouter, createWebHashHistory } from 'vue-router'
import { createPinia } from 'pinia'


  const pinia = createPinia();

  // Vue.createApp이 글로벌 라이브러리이다.
createApp(App)
.use(router)
.use(pinia)
.mount('#app') // -> ES6 라이브러리이다.
```

---

<br>
- useUserDetailsStore.js
	- 'export const'로 모듈을 설정하면, 옵션s API로 기능이 사용된다. 즉, 다른 컴포넌트에서 해당 전역 변수를 사용시, 함수인 ()로 불러내어 사용해야 한다.**
	- export default로 쓰면, ()를 쓰면 안 된다! useUserDetailsStore라는 변수도 지우자
	- 하지만, export const가 pinia 매뉴얼 대로 기본이다!

```javscript
import {defineStore} from "pinia";

// export const로 하면, 옵션s API로 기능이 사용된다. 즉, 함수인 ()로 사용해야 한다.
// export default로 쓰면, ()를 쓰면 안 된다! 변수도 지우자
// 하지만 export const가 기본이다!
export const useUserDetailsStore = defineStore("userDetails", {
    state:()=>({
        id:0,
        username:null,
        email:null,
        role:null
    })
});
```

---

<br><br>

#### b. Pinia 사용 방법 : 상태관리 전역 변수

- `import {useUserDetailsStore} from '../stores/useUserDetailsStore';`

- import된 pinia 상태 관리 변수를 함수로 만들어서 사용한다. 

- 여기서 ()가 'state:()=>{}' 를 의미한다. 

- 인증된 정보를 저장하기 위해서 SSR에서는 Session이나 쿠키를 사용했는데

- CSR에서는 session이나 쿠키가 필요없다. 페이지를 갱신하지 않으면 전역변수가 존재해서 편리하다. 

---

<br>

- 'export const'로 모듈을 설정하면, 옵션s API로 기능이 사용된다. 즉, 다른 컴포넌트에서 해당 전역 변수를 사용시, 함수인 ()로 불러내어 사용해야 한다.**

- export default로 쓰면, ()를 쓰면 안 된다! useUserDetailsStore라는 변수도 지우자

- 하지만, export const가 pinia 매뉴얼 대로 기본이다!

---

<br><br>

#### c. 실습 코드 :

```javascript
<script setup>
import {reactive} from 'vue';
import { useRouter } from 'vue-router';

// 전역 변수를 선언! store에서 가져온다.
// 하나의 모듈에다가 만들어서 공유하면 전역변수가 된다. 
// 모두다 같은 객체를 공유하는지가 궁금하다! 그래서, 여기서 담아서 다른페이지에서 읽어보자!!
// import userDetails from '../stores/UserDetails.js';


let userDetails = useUserDetailsStore();

let router = useRouter();

let user = reactive({
  username:"newlec",
  password:"111",
  role:""
});

async function logHandler(){
  console.log(user.username);
  let response = await fetch("http://localhost:8080/members/login",{
    method:"POST",
    headers:{
      "Accept":"application/json",
      "Content-type":"application/x-www-form-urlencoded"
    },
    body:`username=${user.username}&password=${user.password}`
  });
  let json = await response.json();
  console.log(json);

  // ** 로그인하고 나서 전역 객체(global object)에 로그인한 인증 정보를 담기 **
  // 자바의 entity 값과 같게 반환해줘야 한다.
  userDetails.username = json.result.userName;
  userDetails.password = json.result.pwd;
  userDetails.email = json.result.email;

  // router.push로서 사용하는 방법 
  router.push("/index");
}
</script>

<template>
    <main>
      <div class="sign-in">
        <div class="sign-in-logo">
          <img src="/image/logo-black.svg" alt="Rland" />
        </div>
        <form class="sign-in-form">
          <div class="sign-in-form-input">
            <div>
              <input
                type="text"
                class="input-bottom-line"
                placeholder="아이디"
                required
                v-model="user.username"
              />
            </div>
            <div>
              <input
                type="password"
                class="input-bottom-line"
                placeholder="비밀번호"
                required
                v-model="user.password"
              />
            </div>
          </div>

          <div class="sign-in-form-button">
            <div class="wd-100">
              <input type="submit" value="로그인" class="btn btn-default" @click.prevent="logHandler"/>
            </div>
            <div class="font-14">또는</div>
            <div class="wd-100">
              <a href="" class="deco icon-logo-google btn btn-outline"
                >구글로 로그인</a
              >
            </div>
          </div>
        </form>
        <div class="sign-in-find-user font-14">
          <a href="/sign-up.html">회원가입</a> |
          <a href="">비밀번호 찾기</a>
        </div>
      </div>
    </main>

</template>

<style scoped>
    @import url("/css/sign-in.css")
</style>
```






