---
key: /2023/11/01/Next-Study1.html
title: Next - NextJS Study1
tags: NextJS pageRouter getServerSideProps 
--- 

# 1. Next.js 

### 1) Next.js 개념 

- Next.js는 오픈 소스 JS `프레임워크`이다. React.js는 오픈 소스 JS `라이브러리`이다.

<br>
- Next.js는 React와 매우 유사하고 몇가지 메서드와 개념이 추가된다. 그래서 React.js의 확장판이다.

<br>
- 개발 시, Next.js는 프레임워크에서 정해놓은 방법대로 개발을 해야 한다. 반면, React.js는 프로그래머가 무슨 도구를 쓰던간에 상관없다.

<br>
- 또한, SSR 방식을 제공한다. CSR과 혼합해서 사용 가능하다. 기술적, 비즈니스적으로 매우 효율이 좋다.

<br>
- SEO(검색 엔진)에 최적화되어 있다.

---

<br><br>

### 2) Next.js 프로젝트 생성 및 디렉토리 구조 설명

- 터미널에서 Next.js 프로젝트를 생성하는 명령어** : `npx create-next-app@latest .`
	- `npx`는 create-next-app라는 node.js 라이브러리(보일러 플레이트 역할을 하는 라이브러리)로서 로컬에 설치하여 생성하지 않고 빌려서 사용하는 개념이다.
	- 또한, next.js의 버전이 계속 바뀌기 때문에, 새로운 next 앱을 생성할 때만 사용하기 때문에 로컬에 설치할 필요가 없다.
	- 해당 명령어에서 '.'이 중요하며, 터미널에서 입력 후 생성 마법사 과정을 진행하여 프로젝트 생성 마무리 짓기!!

<br>

- 현재는, App Router보다는 Page Router를 사용할 예정이다. App Router는 서버 컴포넌트나 서스펜스 등등의 추가 개념이 필요하여 러닝커브가 높아서 추후에 공식문서로 학습하기!

<br>

- 현재는 .js 파일로 Next.js의 페이지를 가리키는 컴포넌트 파일로서 생성한다.(나중에는 ts를 사용)

<br>

- 페이지의 경로는 기본적으로 `jsconfig.json` 파일에서 `@/pages`, `@/public` 경로로 설정되어 있다.

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./*"]
    }
  }
}

```

<br>

- 중요** : 디렉토리 구성에서 pages 폴더 내부에 있는 .js 파일들은 각각 페이지 역할을 하는 컴포넌트를 정의하는 파일들이다.(Page Router 개념)

<br>
- Next.js는 `module css` 방식을 이용하는 것을 권장한다.(`/styles/Home.module.css`의 방식처럼)


---

<br><br>

# 2. 페이지 라우터

### 1) Page Router 개념

- 정적 경로 페이지 : post 디렉토리 
	- post 디렉토리 내부의 index.js는 `/post`라는 경로를 의미한다. 물론, 사용자가 임의로 만든 post 디렉토리가 아니라 pages 디렉토리 바로 아래에 about.js가 있다면 `/about`라는 경로를 의미한다.

<br>
- 동적 경로 페이지 1 : post 디렉토리 내부의 [id].js 파일
	- `/post/1`나 `/post/2`처럼 동적 경로를 정의할 수 있다. 
	
<br>
- 동적 경로 페이지 2 : country 디렉토리 내부의 [...code].js 파일
	- 이러한 방식은 `Catch All Routing`이라고 불린다.
	- `/country` 뒤에 모든 동적 경로를 대응해준다.
		- `/country/3/23423/asdf`에 대응해준다.

<br>
- 동적 경로 페이지 3 : country 디렉토리 내부의 [[...code]].js 파일
	- 이러한 방식은 해당 동적경로가 없어도 대응해준다. 404 페이지에 설정 가능!
	- 즉, 'Optional'하다고 해서 `Optional Catch All Routing`이라고 부른다.

<br>
- 이렇게 디렉토리 구조만 만들면, Next.js가 알아서 라우터가 정의한다. 

<br>
- `_document.js`, `_app.js` : 
	- 모든 페이지나 모든 컴포넌트들에 공통적으로 적용되는 로직이나 데이터를 다루는 컴포넌트이다. `_app.js`는 모든 컴포넌트들의 루트 컴포넌트를 의미한다.

<br><br>

#### a. Page Router 라우팅 과정 및 `_app.js` 컴포넌트 개념**

- 1) `/about` 경로를 요청하면, 첫째로, pages 디렉토리 내부에서 `about.js`라는 파일을 찾는다.

<br>

- 2) 둘째로, 해당 `about.js` 파일에서 내부에서 React 컴포넌트를 내보낸다.(현재는 AboutPage라는 React 컴포넌트)
	- about.js

```js
export default function AboutPage() {
  return <div>About Page</div>;
}

```

<br>

- 3) 내보낸 React 컴포넌트를 `_app.js` 파일 내부의 `Component Props`로 전달하여 이렇게 렌더링되고 해당 페이지가 사용자에게 응답된다.
	- App.js

```js
import "@/styles/globals.css";

export default function App({ Component, pageProps }) {
  return <Component {...pageProps} />;
}

```

<br><br>

#### b. `_document.js` 컴포넌트 개념

- `_document.js` : 
	- 모든 페이지에 적용되는 html 코드들이다.(폰트나 메타태그(ogTag), Character-Set, 서드파티스크립트 등의 설정과 그런 것들)
	- 즉, React.js에서의 index.html 역할이다. 껍데기 역할


---

<br><br>


### 2) Page Router 실습

- useRouter를 이용하여 라우팅에 관한 정보를 얻어올 수 있는데 이러한 방식으로 '쿼리스트링'의 인자 값을 가져온다.

<br>
- `/pages/country/[code].js`

```js
import { useRouter } from "next/router";

export default function Country() {
  const router = useRouter();
  const { code } = router.query;

  return <div>Country {code}</div>;
}

```


<br>

#### a. Page Router 라우팅 과정**

- 1) `/about` 경로를 요청하면, 첫째로, pages 디렉토리 내부에서 `about.js`라는 파일을 찾는다.

<br>

- 2) 둘째로, 해당 `about.js` 파일에서 내부에서 React 컴포넌트를 내보낸다.(현재는 AboutPage라는 React 컴포넌트)
	- about.js

```js
export default function AboutPage() {
  return <div>About Page</div>;
}

```

<br>

- 3) 내보낸 React 컴포넌트를 `_app.js` 파일 내부의 `Component Props`로 전달하여 이렇게 렌더링되고 해당 페이지가 사용자에게 응답된다.
	- App.js

```js
import "@/styles/globals.css";

export default function App({ Component, pageProps }) {
  return <Component {...pageProps} />;
}

```


---

<br><br>

### 3) Page 이동하기

#### a. Page 이동하기의 첫번째 방식 : `Link` 컴포넌트 이용

- 페이지를 이동하기 위해서 `Link` 컴포넌트를 이용하기! Next.js에서는 기본적으로 제공하는 해당 컴포넌트로서 CSR 방식으로 페이지 이동이 가능하다.

<br>
- 페이지 이동을 위해 서버에서 요청하지 않고 자체적으로 컴포넌트를 교체하기 때문에 효율적이다.

<br>
- 사용 방식 1 : 템플릿 리터럴 방식, 기본 문자열도 가능, 간단하면 이렇게 문자열로 이동시키기!!
	- `<Link href={`/country/${code}`}>`

<br>	
- 사용 방식 2 : Url Object라는 객체 전달하기(`Link` 컴포넌트의 속성으로 `href={}` 속성에 해당 객체 넣기), 리터럴 객체 형식이다.
	- `pathname: "/country/[code]",` : 해당 페이지를 담당하는 컴포넌트가 작성된 파일의 이름을 넣기
	- `query: { code: code },`

<br><br>

#### b. Page 이동하기의 두번째 방식 : `useRouter` 컴포넌트 이용

- 이벤트에 관하여 페이지가 이동하도록 하기 위해서는 이벤트 핸들러에 `useRouter` 컴포넌트 이용하기

<br>	
- React.js처럼 router.push() 이용하기! `useRouter` 컴포넌트에는 push말고도 back, replace, reload 등 여러 상황에 맞는 여러가지 메서드들이 있다. 
	- `useRouter`에 관하여 공식문서를 참고하여 메서드 역할 알아보기!!

<br><br>

#### c. 실습 코드 

- index.js

```js
import Link from "next/link";
import { useRouter } from "next/router";

export default function Home() {
  const code = "KOR";

  const router = useRouter();

  const onClickButton = () => {
    router.push({
      pathname: "/country/[code]",
      query: { code: code },
    });
  };

  return (
    <div>
      Home Page
      <div>
        <button onClick={onClickButton}>
          Search 페이지로 이동
        </button>
      </div>
      <div>
        <Link href={"/search"}>Search Page 이동</Link>
      </div>
      <div>
        <Link
          href={{
            pathname: "/country/[code]",
            query: { code: code },
          }}
        >
          {code} 페이지로 이동
        </Link>
      </div>
    </div>
  );
}

```

---

<br><br>

### 4) 공통으로 사용하는 레이아웃 설정하기



---

<br><br>


# 3. SSR 렌더링

### 1) SSR router 개념

#### a. getServerSideProps vs Component function

- next.js에서 `getServerSideProps` 함수는 SSR 전용, 일반 `컴포넌트 함수`는 CSR 전용이라서 2가지를 혼용해서 사용할 수 있다.
   - next.js에서 보통 `데이터를 만들어오는 곳`은 'SSR' 방식으로 사용하고, `화면에 보여주는 용도`에서는 'CSR' 방식으로 사용한다.

---

<br><br>

#### b. useRouter vs context

- `context` 객체는 서버측에서 API의 데이터를 사용할 때, 이용한다. 

<br>
- `useRouter` 메서드는 클라이언트측에서 API의 데이터를 사용할 때, 이용한다.

